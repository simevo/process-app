// configuration for jshint
/* jshint browser: true, devel: true, strict: true */
/* global ko */

function unit_list(units) {
  "use strict";
  var dimensions = [
    {"kmol": [0, 1], "mol": [0, 0.001]},
    {"cm": [0, 0.01], "dm": [0, 0.1], "ft": [0, 0.3048], "in": [0, 0.0254], "km": [0, 1000], "m": [0, 1], "mm": [0, 0.001], "um": [0, 1e-06]},
    {"g": [0, 0.001], "kg": [0, 1], "lb": [0, 0.453592], "mg": [0, 1e-06], "t": [0, 1000]},
    {"K": [0, 1], "°C": [273.15, 1], "°F": [255.372, 0.555556]},
    {"d": [0, 86400], "h": [0, 3600], "min": [0, 60], "s": [0, 1], "yr": [0, 3.15569e+07]},
    {"$": [0, 0.731154], "€": [0, 1]},
    {"m s^-2": [0, 1], "m/s2": [0, 1]},
    {"Nl/min": [0, 7.43589e-07], "Nm3/d": [0, 5.16382e-07], "Nm3/h": [0, 1.23932e-05], "STPccm": [0, 6.81239e-10], "kmol s^-1": [0, 1], "kmol/h": [0, 0.000277778], "kmol/s": [0, 1], "lbmol/h": [0, 0.000125998], "mol/h": [0, 2.77778e-07], "mol/s": [0, 0.001]},
    {"C/kmol": [0, 1], "kmol^-1 A s": [0, 1]},
    {"BTU/lbmol": [0, 2326], "J/kmol": [0, 1], "kJ/kmol": [0, 1000], "kcal/kmol": [0, 4186.8], "kmol^-1 m^2 kg s^-2": [0, 1]},
    {"J/(kmol*K)": [0, 1], "J/kmol/K": [0, 1], "kJ/kmol/K": [0, 1000], "kcal/kmol/K": [0, 4186.8], "kmol^-1 m^2 kg K^-1 s^-2": [0, 1]},
    {"cm2": [0, 0.0001], "dm2": [0, 0.01], "ft2": [0, 0.092903], "m2": [0, 1], "m^2": [0, 1], "mm2": [0, 1e-06]},
    {"A m^-2": [0, 1], "A/cm2": [0, 10000], "A/dm2": [0, 100], "A/ft2": [0, 10.7639], "A/m2": [0, 1], "A/mm2": [0, 1e+06], "mA/cm2": [0, 10]},
    {"A^-2 m^4 kg s^-3": [0, 1], "ohm*cm2": [0, 0.0001], "ohm*m2": [0, 1]},
    {"W/m2": [0, 1], "kg s^-3": [0, 1]},
    {"A^2 m^-2 kg^-1 s^4": [0, 1], "F": [0, 1]},
    {"A^2 m^-2 kg^-1 s^3": [0, 1], "S": [0, 1]},
    {"g/m3": [0, 0.001], "kg/m3": [0, 1], "lb/ft3": [0, 16.0185], "m^-3 kg": [0, 1], "mg/m3": [0, 1e-06]},
    {"m2/s": [0, 1], "m^2 s^-1": [0, 1]},
    {"Pa*s": [0, 1], "cP": [0, 0.001], "mPa*s": [0, 0.001], "m^-1 kg s^-1": [0, 1], "uPa*s": [0, 1e-06]},
    {"A s": [0, 1], "C": [0, 1]},
    {"A^-1 m^2 kg s^-3": [0, 1], "V": [0, 1], "mV": [0, 0.001]},
    {"A^-2 m^2 kg s^-3": [0, 1], "ohm": [0, 1]},
    {"J/K": [0, 1], "m^2 kg K^-1 s^-2": [0, 1]},
    {"BTU/h/°F": [0, 0.527528], "W/K": [0, 1], "m^2 kg K^-1 s^-3": [0, 1]},
    {"kg/m7": [0, 1], "m^-7 kg": [0, 1]},
    {"N": [0, 1], "m kg s^-2": [0, 1]},
    {"Hz": [0, 1], "rpm": [0, 0.0166667], "s^-1": [0, 1]},
    {"BTU/(h*ft2*F)": [0, 5.67826], "W/(m2*K)": [0, 1], "W/m2/K": [0, 1], "kcal/(h*m2*K)": [0, 1.163], "kg K^-1 s^-3": [0, 1]},
    {"kg^-1 K s^3": [0, 1], "m2*K/W": [0, 1]},
    {"A^-2 m^2 kg s^-2": [0, 1], "H": [0, 1]},
    {"1/m": [0, 1], "m^-1": [0, 1]},
    {"kmol kg^-1": [0, 1], "kmol/kg": [0, 1], "mol/kg": [0, 0.001]},
    {"1/K": [0, 1], "K^-1": [0, 1]},
    {"m s": [0, 1], "m*s": [0, 1]},
    {"A^-1 m^2 kg s^-2": [0, 1], "Wb": [0, 1]},
    {"A^-1 kg s^-2": [0, 1], "T": [0, 1]},
    {"g/d": [0, 1.15741e-08], "kg s^-1": [0, 1], "kg/d": [0, 1.15741e-05], "kg/h": [0, 0.000277778], "kg/s": [0, 1], "lb/h": [0, 0.000125998], "t/d": [0, 0.0115741], "t/h": [0, 0.277778], "t/yr": [0, 3.16888e-05]},
    {"kg/J": [0, 1], "m^-2 s^2": [0, 1]},
    {"BTU/lb": [0, 2326], "J/kg": [0, 1], "MJ/kg": [0, 1e+06], "kJ/g": [0, 1e+06], "kJ/kg": [0, 1000], "kcal/kg": [0, 4186.8], "m2/s2": [0, 1], "m^2 s^-2": [0, 1]},
    {"W/kg": [0, 1], "kW/kg": [0, 1000], "m^2 s^-3": [0, 1]},
    {"BTU/lb/°F": [0, 4186.8], "J/(kg*K)": [0, 1], "J/kg/K": [0, 1], "kJ/kg/K": [0, 1000], "kcal/(kg*K)": [0, 4186.8], "kcal/kg/K": [0, 4186.8], "m^2 K^-1 s^-2": [0, 1]},
    {"m3/kg": [0, 1], "m^3 kg^-1": [0, 1]},
    {"kmol m^-3": [0, 1], "kmol/m3": [0, 1], "lbmol/ft3": [0, 16.0185], "mmol/dm3": [0, 0.001], "mol/dm3": [0, 1], "mol/m3": [0, 0.001]},
    {"kmol^-1 m^3": [0, 1], "m3/kmol": [0, 1]},
    {"g/Nm3": [0, 0.0224138], "kg/kmol": [0, 1], "kmol^-1 kg": [0, 1], "lb/lbmol": [0, 1], "mg/Nm3": [0, 2.24138e-05]},
    {"GPU": [0, 3.34643e-13], "kmol m^-1 kg^-1 s": [0, 1], "kmol/kg/m": [0, 1]},
    {"BTU/h": [0, 0.293071], "GW": [0, 1e+09], "MW": [0, 1e+06], "TW": [0, 1e+12], "W": [0, 1], "kW": [0, 1000], "kcal/h": [0, 1.163], "kcal/s": [0, 4186.8], "mW": [0, 0.001], "m^2 kg s^-3": [0, 1]},
    {"BTU/ft3": [0, 37258.9], "J/l": [0, 1000], "J/m3": [0, 1], "MPa": [0, 1e+06], "Pa": [0, 1], "Torr": [0, 133.322], "atm": [0, 101325], "bar": [0, 100000], "barg": [101325, 100000], "hPa": [0, 100], "kJ/m3": [0, 1000], "kPa": [0, 1000], "kWh/m3": [0, 3.6e+06], "kcal/l": [0, 4.1868e+06], "kcal/m3": [0, 4186.8], "kg/cm2": [0, 98060], "m^-1 kg s^-2": [0, 1], "mbar": [0, 100], "mmH2O": [0, 9.806], "mmHg": [0, 133.322], "psi": [0, 6894.76]},
    {"Pa*m6/kmol2": [0, 1], "kmol^-2 m^5 kg s^-2": [0, 1]},
    {"Pa*m6/kmol2/K": [0, 1], "kmol^-2 m^5 kg K^-1 s^-2": [0, 1]},
    {"Pa*m6/kmol2/K2": [0, 1], "kmol^-2 m^5 kg K^-2 s^-2": [0, 1]},
    {"A^-2 m^3 kg s^-3": [0, 1], "ohm*cm": [0, 0.01], "ohm*m": [0, 1]},
    {"kg/(m3*K2)": [0, 1], "m^-3 kg K^-2": [0, 1]},
    {"Pa/K2": [0, 1], "m^-1 kg K^-2 s^-2": [0, 1]},
    {"J/(kg*K3)": [0, 1], "m^2 K^-3 s^-2": [0, 1]},
    {"N/m": [0, 1], "kg s^-2": [0, 1]},
    {"kg/(m3*K)": [0, 1], "m^-3 kg K^-1": [0, 1]},
    {"Pa/K": [0, 1], "m^-1 kg K^-1 s^-2": [0, 1]},
    {"J/(kg*K2)": [0, 1], "m^2 K^-2 s^-2": [0, 1]},
    {"K2/Pa": [0, 1], "m kg^-1 K^2 s^2": [0, 1]},
    {"K/Pa": [0, 1], "m kg^-1 K s^2": [0, 1]},
    {"W/(m*K)": [0, 1], "W/m/K": [0, 1], "m kg K^-1 s^-3": [0, 1]},
    {"m*K/W": [0, 1], "m^-1 kg^-1 K s^3": [0, 1]},
    {"m2*K2/W2": [0, 1], "m^-2 kg^-2 K^2 s^6": [0, 1]},
    {"N*m4*kmol-2": [0, 1], "kmol^-2 m^5 kg s^-2": [0, 1]},
    {"N*m4": [0, 1], "m^5 kg s^-2": [0, 1]},
    {"m s^-1": [0, 1], "m/s": [0, 1]},
    {"bbl": [0, 0.158987], "cm3": [0, 1e-06], "dm3": [0, 0.001], "ft3": [0, 0.0283168], "l": [0, 0.001], "m3": [0, 1], "m^3": [0, 1], "ml": [0, 1e-06], "mm3": [0, 1e-09], "ul": [0, 1e-09]},
    {"ccm": [0, 1.66667e-08], "ft3/h": [0, 7.86579e-06], "l/h": [0, 2.77778e-07], "m3/h": [0, 0.000277778], "m3/s": [0, 1], "m^3 s^-1": [0, 1]},
    {"BTU": [0, 1055.06], "J": [0, 1], "MWh": [0, 3.6e+09], "kJ": [0, 1000], "kWh": [0, 3.6e+06], "kcal": [0, 4186.8], "m^2 kg s^-2": [0, 1], "mmBTU": [0, 1.05506e+09]},
    {"$/J": [0, 0.731154], "$/mmBTU": [0, 6.93001e-10], "m^-2 kg^-1 s^2 €": [0, 1], "€/J": [0, 1], "€/MWh": [0, 2.77778e-10], "€/kWh": [0, 2.77778e-07], "€/kcal": [0, 0.000238846], "€/mmBTU": [0, 9.47817e-10]}
  ];
  var ul = {};
  dimensions.some(function(dimension) {
    if (units in dimension) {
      ul = dimension;
      return true;
    }
  });
  // provide dummy conversion
  ul[units] = [0.0, 1.0];
  return ul;
}

function conversionViewModel(params) {
  "use strict";
  /* jshint validthis: true */
  this.unit_list = ko.observable(unit_list(params.units()));
  this.value = params.value;
  this.units =  params.units;
  this.display = ko.pureComputed({
    read: function () {
      var conversion = this.unit_list()[this.units()];
      // convert value from base unit to unit
      return ((this.value() - conversion[0]) / conversion[1]);
    },
    write: function (v) {
      var conversion = this.unit_list()[this.units()];
      // convert value from unit to base unit
      this.value(v * conversion[1] + conversion[0]);
    },
    owner: this
  });
}

ko.components.register('conversion-widget', {
  viewModel: conversionViewModel,
  template: { element: 'conversion-widget-template' }
});
